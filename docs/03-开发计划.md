# 开发计划
# Development Plan

## 项目概述 Project Overview

实验室管理系统（Laboratory Management System）是一个综合性的实验室运营管理平台，用于管理失效分析（FA）和可靠性测试实验室的日常运营。

---

## 开发阶段 Development Phases

### 阶段1：基础架构搭建 Foundation Setup ✅

| 任务ID | 任务描述 | 状态 |
|--------|----------|------|
| FD-1.1 | 项目初始化（Vite + React + TypeScript） | ✅ 已完成 |
| FD-1.2 | FastAPI后端框架搭建 | ✅ 已完成 |
| FD-1.3 | SQLAlchemy ORM配置 | ✅ 已完成 |
| FD-1.4 | Alembic数据库迁移配置 | ✅ 已完成 |
| FD-1.5 | 前端路由配置（React Router） | ✅ 已完成 |
| FD-1.6 | Zustand状态管理配置 | ✅ 已完成 |
| FD-1.7 | Axios HTTP客户端配置 | ✅ 已完成 |

---

### 阶段2：核心数据模型 Core Data Models ✅

| 任务ID | 任务描述 | 状态 |
|--------|----------|------|
| DM-2.1 | 用户模型（User） | ✅ 已完成 |
| DM-2.2 | 站点模型（Site） | ✅ 已完成 |
| DM-2.3 | 实验室模型（Laboratory） | ✅ 已完成 |
| DM-2.4 | 人员模型（Personnel） | ✅ 已完成 |
| DM-2.5 | 设备模型（Equipment） | ✅ 已完成 |
| DM-2.6 | 技能模型（Skill） | ✅ 已完成 |
| DM-2.7 | 工单模型（WorkOrder） | ✅ 已完成 |
| DM-2.8 | 任务模型（Task） | ✅ 已完成 |
| DM-2.9 | 物料模型（Material） | ✅ 已完成 |
| DM-2.10 | 客户模型（Client） | ✅ 已完成 |
| DM-2.11 | 审计日志模型（AuditLog） | ✅ 已完成 |
| DM-2.12 | 权限模型（Permission） | ✅ 已完成 |

---

### 阶段3：API端点开发 API Endpoint Development ✅

| 任务ID | 任务描述 | 状态 |
|--------|----------|------|
| API-3.1 | 认证API（/api/v1/auth/*） | ✅ 已完成 |
| API-3.2 | 用户API（/api/v1/users/*） | ✅ 已完成 |
| API-3.3 | 站点API（/api/v1/sites/*） | ✅ 已完成 |
| API-3.4 | 实验室API（/api/v1/laboratories/*） | ✅ 已完成 |
| API-3.5 | 人员API（/api/v1/personnel/*） | ✅ 已完成 |
| API-3.6 | 设备API（/api/v1/equipment/*） | ✅ 已完成 |
| API-3.7 | 技能API（/api/v1/skills/*） | ✅ 已完成 |
| API-3.8 | 工单API（/api/v1/work-orders/*） | ✅ 已完成 |
| API-3.9 | 物料API（/api/v1/materials/*） | ✅ 已完成 |
| API-3.10 | 客户API（/api/v1/clients/*） | ✅ 已完成 |
| API-3.11 | 仪表板API（/api/v1/dashboard/*） | ✅ 已完成 |
| API-3.12 | 交接API（/api/v1/handovers/*） | ✅ 已完成 |
| API-3.13 | 方法API（/api/v1/methods/*） | ✅ 已完成 |
| API-3.14 | 班次API（/api/v1/shifts/*） | ✅ 已完成 |
| API-3.15 | 审计日志API（/api/v1/audit-logs/*） | ✅ 已完成 |
| API-3.16 | 权限API（/api/v1/permissions/*） | ✅ 已完成 |
| API-3.17 | 报表API（/api/v1/reports/*） | ✅ 已完成 |

---

### 阶段4：前端页面开发 Frontend Page Development ✅

| 任务ID | 任务描述 | 状态 |
|--------|----------|------|
| FE-4.1 | 登录页面（LoginPage） | ✅ 已完成 |
| FE-4.2 | 主布局（MainLayout） | ✅ 已完成 |
| FE-4.3 | 仪表板页面（DashboardPage） | ✅ 已完成 |
| FE-4.4 | 设备仪表板（EquipmentDashboard） | ✅ 已完成 |
| FE-4.5 | 人员仪表板（PersonnelDashboard） | ✅ 已完成 |
| FE-4.6 | 站点管理页面（SitesPage） | ✅ 已完成 |
| FE-4.7 | 实验室管理页面（LaboratoriesPage） | ✅ 已完成 |
| FE-4.8 | 人员管理页面（PersonnelPage） | ✅ 已完成 |
| FE-4.9 | 设备管理页面（EquipmentPage） | ✅ 已完成 |
| FE-4.10 | 工单管理页面（WorkOrdersPage） | ✅ 已完成 |
| FE-4.11 | 工单查询页面（WorkOrderQueryPage） | ✅ 已完成 |
| FE-4.12 | 物料管理页面（MaterialsPage） | ✅ 已完成 |
| FE-4.13 | 客户管理页面（ClientsPage） | ✅ 已完成 |
| FE-4.14 | 客户SLA页面（ClientSLAsPage） | ✅ 已完成 |
| FE-4.15 | 技能矩阵页面（SkillsMatrix） | ✅ 已完成 |
| FE-4.16 | 技能配置页面（SkillsConfig） | ✅ 已完成 |
| FE-4.17 | 班次管理页面（ShiftsPage） | ✅ 已完成 |
| FE-4.18 | 交接管理页面（HandoversPage） | ✅ 已完成 |
| FE-4.19 | 人员借调页面（Transfers） | ✅ 已完成 |
| FE-4.20 | 方法管理页面（MethodsPage） | ✅ 已完成 |
| FE-4.21 | 审计日志页面（AuditLogsPage） | ✅ 已完成 |
| FE-4.22 | 用户管理页面（UserManagementPage） | ✅ 已完成 |
| FE-4.23 | 系统设置页面（SettingsPage） | ✅ 已完成 |

---

### 阶段5：权限与安全 Authorization & Security ✅

| 任务ID | 任务描述 | 状态 |
|--------|----------|------|
| SEC-5.1 | JWT认证实现 | ✅ 已完成 |
| SEC-5.2 | 密码哈希（bcrypt） | ✅ 已完成 |
| SEC-5.3 | 角色定义（Admin/Manager/Engineer/Technician/Viewer） | ✅ 已完成 |
| SEC-5.4 | 权限矩阵实现 | ✅ 已完成 |
| SEC-5.5 | 路由保护（ProtectedRoute） | ✅ 已完成 |
| SEC-5.6 | 基于角色的首页重定向 | ✅ 已完成 |
| SEC-5.7 | 菜单权限过滤 | ✅ 已完成 |
| SEC-5.8 | API速率限制 | ✅ 已完成 |

---

### 阶段6：测试与部署 Testing & Deployment ⏳

| 任务ID | 任务描述 | 状态 |
|--------|----------|------|
| TS-6.1 | 后端单元测试 | ✅ 已完成 (164 tests) |
| TS-6.2 | API集成测试 | ✅ 已完成 |
| TS-6.3 | 前端E2E测试配置（Playwright） | ✅ 已完成 |
| TS-6.4 | 性能测试执行 | ⏳ 进行中 |
| TS-6.5 | 安全测试执行 | ⏳ 进行中 |
| DP-6.1 | Docker配置 | ✅ 已完成 |
| DP-6.2 | Docker Compose配置 | ✅ 已完成 |
| DP-6.3 | Nginx配置 | ✅ 已完成 |
| DP-6.4 | 生产环境部署 | ⏳ 待执行 |

---

### 阶段7：UI框架迁移 UI Framework Migration ❌ 已回滚

| 任务ID | 任务描述 | 状态 |
|--------|----------|------|
| UI-7.1 | Tailwind CSS配置 | ❌ 已回滚 |
| UI-7.2 | Headless UI集成 | ❌ 已回滚 |
| UI-7.3 | TanStack Table集成 | ❌ 已回滚 |
| UI-7.4 | 组件库文件夹结构 | ❌ 已回滚 |
| UI-7.5 | cn()工具函数 | ❌ 已回滚 |
| UI-7.6 | Button组件 | ❌ 已回滚 |
| UI-7.7 | Input组件 (Input/Password/TextArea/InputNumber) | ❌ 已回滚 |
| UI-7.8 | Select组件 | ❌ 已回滚 |
| UI-7.9 | Modal组件 | ❌ 已回滚 |
| UI-7.10 | Table组件 | ❌ 已回滚 |
| UI-7.11 | Form hooks (useForm/FormItem) | ❌ 已回滚 |
| UI-7.12 | DatePicker组件 | ❌ 已回滚 |
| UI-7.13 | Toast通知系统 | ❌ 已回滚 |
| UI-7.14 | 其他基础组件 (Spin/Alert/Tag/Badge/Switch/Progress/Tooltip) | ❌ 已回滚 |
| UI-7.15 | 页面迁移（23个页面） | ❌ 已回滚 |
| UI-7.16 | Ant Design移除 | ❌ 已回滚 |

> **说明**: UI框架迁移因稳定性问题已回滚至Ant Design。当前前端使用Ant Design 5.24作为UI组件库。

---

## 当前进度 Current Progress

### 已完成 Completed:
- 阶段1-5: 基础架构、数据模型、API、前端页面、权限安全 ✅
- 后端单元测试: 11个测试文件 ✅
- Docker部署配置 ✅
- 前端23个页面全部开发完成 ✅
- 综合仪表板中文本地化 ✅

### 当前状态 Current Status:
- 前端技术栈: React 18.3 + TypeScript 5.9 + Ant Design 5.24
- 后端技术栈: FastAPI 0.109 + SQLAlchemy 2.0 + MySQL/SQLite
- UI框架: Ant Design（之前的Tailwind迁移已回滚）

### 进行中 In Progress:
- 阶段6: 性能测试、安全测试、生产部署 ⏳

---

## 下一步行动 Next Actions

### 优先级1：完成阶段6测试与部署

#### TS-6.4 性能测试执行
```bash
# 后端性能测试
pip install locust
locust -f tests/performance/locustfile.py --host=http://localhost:8000

# 前端性能测试
npm run build
npx lighthouse http://localhost:5173 --output=html
```

测试目标:
- API响应时间 < 200ms（P95）
- 并发用户支持 > 100
- 页面加载时间 < 3s

#### TS-6.5 安全测试执行
```bash
# 依赖安全扫描
pip install safety
safety check -r requirements.txt

# 前端依赖扫描
npm audit

# OWASP检查清单
- SQL注入防护 ✓（SQLAlchemy ORM）
- XSS防护 ✓（React自动转义）
- CSRF防护 ✓（JWT Token）
- 认证安全 ✓（bcrypt + JWT）
```

#### DP-6.4 生产环境部署
```bash
# 1. 服务器准备
ssh user@server
sudo apt update && sudo apt upgrade

# 2. Docker安装
curl -fsSL https://get.docker.com | sh

# 3. 部署应用
git clone <repo>
cp .env.example .env
# 编辑 .env 配置
docker-compose up -d

# 4. 验证部署
curl http://localhost/health
```

### 优先级2：功能优化

| 优化项 | 描述 | 优先级 |
|--------|------|--------|
| 国际化完善 | 完成所有页面中文翻译 | 高 |
| 性能优化 | 代码分割、懒加载已实现 | 中 |
| 错误处理 | 统一错误提示和处理 | 中 |
| 数据导出 | PDF报表功能完善 | 低 |

---

## 已完成的组件库 Completed Component Library

| 组件 | 文件位置 | API兼容性 |
|------|----------|-----------|
| Button | ui/core/Button/ | variant, size, loading, icon, danger, block |
| Input | ui/core/Input/ | prefix, suffix, allowClear, error |
| Password | ui/core/Input/ | visibilityToggle |
| TextArea | ui/core/Input/ | autoSize, showCount, maxLength |
| InputNumber | ui/core/Input/ | min, max, step, precision, controls |
| Select | ui/core/Select/ | showSearch, multiple, allowClear, options |
| Switch | ui/core/Switch/ | checkedChildren, loading |
| Tag | ui/core/Tag/ | color (16 presets), closable |
| Badge | ui/core/Badge/ | count, dot, status |
| Progress | ui/core/Progress/ | type (line/circle), percent, status |
| Tooltip | ui/core/Tooltip/ | placement (12 positions), trigger |
| DatePicker | ui/core/DatePicker/ | picker (date/month/year), format |
| Spin | ui/feedback/Spin/ | size, tip |
| Alert | ui/feedback/Alert/ | type, closable, banner |
| Toast | ui/feedback/Toast/ | success, error, warning, info, loading |
| Modal | ui/overlay/Modal/ | open, onOk, onCancel, confirmLoading, footer |
| Table | ui/data-display/Table/ | columns, dataSource, pagination, rowSelection |
| Form | ui/form/ | useForm(), FormItem, validation |

---

## 技术栈 Technology Stack

### 后端 Backend
- Python 3.12+
- FastAPI
- SQLAlchemy 2.x
- Alembic
- SQLite (开发) / MySQL (生产)
- JWT认证

### 前端 Frontend
- React 19
- TypeScript
- Ant Design 6.x → Tailwind CSS + Headless UI（迁移中）
- TanStack Table
- Recharts
- Zustand
- Axios
- dayjs

### 部署 Deployment
- Docker
- Docker Compose
- Nginx
- Alibaba Cloud ECS

---

## 风险与缓解措施 Risks & Mitigations

| 风险 | 缓解措施 |
|------|----------|
| UI迁移期间功能回归 | 保留Ant Design直到迁移完成，逐页迁移 |
| 生产部署问题 | 完整的Docker Compose配置，健康检查端点 |
| 性能问题 | 代码分割（lazy loading），API缓存 |
| 安全漏洞 | 定期依赖更新，OWASP检查清单 |

---

## 文档更新记录 Document History

| 日期 | 版本 | 更新内容 |
|------|------|----------|
| 2026-01-31 | v1.0 | 初始版本 |
| 2026-02-01 | v1.1 | 添加阶段4-5完成状态，更新阶段6-7进度 |
| 2026-02-01 | v1.2 | UI组件库开发完成，更新页面迁移计划 |
| 2026-02-02 | v1.3 | 阶段7 UI框架迁移完成：23个页面全部迁移，Ant Design依赖移除 |
